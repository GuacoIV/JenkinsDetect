<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="43,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T29U3">f</span>,<span class="var type0" id="S3T0U4">t</span>,<span class="var type0" id="S4T0U5">w</span>]=enframe(<span class="var type1" id="S5T1U8">x</span>,<span class="var type1" id="S6T20U9">win</span>,<span class="mxinfo" id="T2:U4"><span class="var type2" id="S7T2V1U10">inc</span></span>,<span class="var type0" id="S8T0U11">m</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%ENFRAME split signal up into (overlapping) frames: one per row. [F,T]=(X,WIN,INC)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Usage:  (1) f=enframe(x,n)     % split into frames of length n</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%         (2) f=enframe(x,hamming(n,'periodic'),n/4)     % use a 75% overlapped Hamming window of length n</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%         (3) frequency domain frame-based processing:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%             S=<span class="keyword">...</span><span class="comment">;                              % input signal</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%             OV=2;                               % overlap factor of 2 (4 is also often used)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%             INC=20;                             % set frame increment in samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%             NW=INC*OV;                          % DFT window length</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%             W=sqrt(hamming(NW,'periodic'));     % omit sqrt if OV=4</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%             W=W/sqrt(sum(W(1:INC:NW).^2));      % normalize window</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%             F=rfft(enframe(S,W,INC),NW,2);      % do STFT: one row per time frame, +ve frequencies only</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%             <span class="keyword">...</span><span class="comment"> process frames ...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%             X=overlapadd(irfft(F,NW,2),W,INC);  % reconstitute the time waveform (omit "X=" to plot waveform)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%  Inputs:   x    input signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%          win    window or window length in samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%          inc    frame increment in samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%            m    mode input:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%                  'z'  zero pad to fill up final frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%                  'r'  reflect last few samples for final frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%                  'A'  calculate the t output as the centre of mass</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%                  'E'  calculate the t output as the centre of energy</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">% Outputs:   f    enframed data - one frame per row</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%            t    fractional time in samples at the centre of each frame</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%            w    window function used</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">% By default, the number of frames will be rounded down to the nearest</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">% integer and the last few samples of x() will be ignored unless its length</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">% is lw more than a multiple of inc. If the 'z' or 'r' options are given,</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% the number of frame will instead be rounded up and no samples will be ignored.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">% Example of frame-based processing:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%          INC=20                               % set frame increment in samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%          NW=INC*2                             % oversample by a factor of 2 (4 is also often used)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">%          S=cos((0:NW*7)*6*pi/NW);             % example input signal</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%          W=sqrt(hamming(NW),'periodic'));     % sqrt hamming window of period NW</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%          F=enframe(S,W,INC);                  % split into frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%          <span class="keyword">...</span><span class="comment"> process frames ...</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%          X=overlapadd(F,W,INC);               % reconstitute the time waveform (omit "X=" to plot waveform)</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,44" id="srcline44"> 44</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">% Bugs/Suggestions:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%  (1) Possible additional mode options:</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%        'u'  modify window for first and last few frames to ensure WOLA</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%        'a'  normalize window to give a mean of unity after overlaps</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">%        'e'  normalize window to give an energy of unity after overlaps</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%        'wm' use Hamming window</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">%        'wn' use Hanning window</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%        'x'  include all frames that include any of the x samples</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,53" id="srcline53"> 53</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%      Copyright (C) Mike Brookes 1997-2012</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%      Version: $Id: enframe.m 4073 2014-01-16 08:38:22Z dmb $</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%   VOICEBOX is a MATLAB toolbox for speech processing.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">%   Home page: http://www.ee.ic.ac.uk/hp/staff/dmb/voicebox/voicebox.html</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%   This program is free software; you can redistribute it and/or modify</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%   it under the terms of the GNU General Public License as published by</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%   the Free Software Foundation; either version 2 of the License, or</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">%   (at your option) any later version.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%   This program is distributed in the hope that it will be useful,</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">%   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%   GNU General Public License for more details.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%   You can obtain a copy of the GNU General Public License from</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">%   http://www.gnu.org/copyleft/gpl.html or by writing to</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%   Free Software Foundation, Inc.,675 Mass Ave, Cambridge, MA 02139, USA.</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,75" id="srcline75"> 75</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,76" id="srcline76"> 76</a></span><span class="line"><span class="mxinfo" id="T2:U6"><span class="var type1" id="S9T2U14">nx</span>=<span class="mxinfo" id="T2:U8">length(<span class="var type1" id="S5T1U18">x</span>(:))</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,77" id="srcline77"> 77</a></span><span class="line"><span class="keyword">if</span> nargin&lt;2 || isempty(<span class="var type1" id="S6T20U29">win</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,78" id="srcline78"> 78</a></span><span class="line">    <span class="var type0" id="S6T0U32">win</span>=<span class="var type0" id="S9T0U33">nx</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,79" id="srcline79"> 79</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,80" id="srcline80"> 80</a></span><span class="line"><span class="keyword">if</span> nargin&lt;4 || isempty(<span class="var type0" id="S8T0U43">m</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,81" id="srcline81"> 81</a></span><span class="line">    <span class="mxinfo" id="T30:U11"><span class="var type1" id="S8T30U46">m</span>=<span class="mxinfo" id="T30:U13"><span class="string">''</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,82" id="srcline82"> 82</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,83" id="srcline83"> 83</a></span><span class="line"><span class="mxinfo" id="T2:U14"><span class="var type1" id="S13T2U50">nwin</span>=<span class="mxinfo" id="T2:U16">length(<span class="var type1" id="S6T20U53">win</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,84" id="srcline84"> 84</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S13T2U57">nwin</span> == 1</span></span>
<span class="srcline"><span class="lineno"><a href="43,85" id="srcline85"> 85</a></span><span class="line">    <span class="var type0" id="S14T0U61">lw</span> = <span class="var type0" id="S6T0U62">win</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,86" id="srcline86"> 86</a></span><span class="line">    <span class="var type0" id="S4T0U65">w</span> = ones(1,<span class="var type0" id="S14T0U69">lw</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,87" id="srcline87"> 87</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,88" id="srcline88"> 88</a></span><span class="line">    <span class="mxinfo" id="T2:U19"><span class="var type1" id="S14T2U73">lw</span> = <span class="mxinfo" id="T2:U21"><span class="var type1" id="S13T2U74">nwin</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,89" id="srcline89"> 89</a></span><span class="line">    <span class="mxinfo" id="T28:U23"><span class="var type1" id="S4T28U77">w</span> = <span class="mxinfo" id="T28:U25"><span class="mxinfo" id="T20:U26"><span class="var type1" id="S6T20U80">win</span>(:)</span>.'</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,90" id="srcline90"> 90</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,91" id="srcline91"> 91</a></span><span class="line"><span class="keyword">if</span> (nargin &lt; 3) || isempty(<span class="var type1" id="S7T2U92">inc</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,92" id="srcline92"> 92</a></span><span class="line">    <span class="var type0" id="S7T0U95">inc</span> = <span class="var type0" id="S14T0U96">lw</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,93" id="srcline93"> 93</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,94" id="srcline94"> 94</a></span><span class="line"><span class="mxinfo" id="T2:U29"><span class="var type1" id="S16T2U99">nli</span>=<span class="mxinfo" id="T2:U31"><span class="var type1" id="S9T2U102">nx</span>-<span class="var type1" id="S14T2U103">lw</span>+<span class="var type1" id="S7T2U104">inc</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,95" id="srcline95"> 95</a></span><span class="line"><span class="mxinfo" id="T2:U35"><span class="var type1" id="S17T2U107">nf</span> = <span class="mxinfo" id="T2:U37">max(fix(<span class="var type1" id="S16T2U113">nli</span>/<span class="var type1" id="S7T2U114">inc</span>),0)</span></span>;   <span class="comment">% number of full frames</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,96" id="srcline96"> 96</a></span><span class="line"><span class="mxinfo" id="T2:U40"><span class="var type1" id="S20T2U118">na</span>=<span class="mxinfo" id="T2:U42"><span class="mxinfo" id="T2:U43"><span class="var type1" id="S16T2U121">nli</span>-<span class="mxinfo" id="T2:U45"><span class="mxinfo" id="T2:U46"><span class="var type1" id="S7T2U123">inc</span></span>*<span class="mxinfo" id="T2:U48"><span class="var type1" id="S17T2U124">nf</span></span></span></span>+<span class="mxinfo" id="T2:U50">(<span class="var type1" id="S17T2U128">nf</span>==0)*(<span class="var type1" id="S14T2U132">lw</span>-<span class="var type1" id="S7T2U133">inc</span>)</span></span></span>;       <span class="comment">% number of samples left over</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,97" id="srcline97"> 97</a></span><span class="line"><span class="mxinfo" id="T5:U54"><span class="var type1" id="S21T5U136">fx</span>=<span class="mxinfo" id="T5:U56">nargin&gt;3 &amp;&amp; (any(<span class="var type0" id="S8T0U148">m</span>==<span class="string">'z'</span>) || any(<span class="var type0" id="S8T0U153">m</span>==<span class="string">'r'</span>)) &amp;&amp; <span class="var type0" id="S20T0U156">na</span>&gt;0</span></span>; <span class="comment">% need an extra row</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,98" id="srcline98"> 98</a></span><span class="line"><span class="mxinfo" id="T29:U57"><span class="var type1" id="S2T29U160">f</span>=<span class="mxinfo" id="T29:U59">zeros(<span class="mxinfo" id="T2:U60"><span class="var type1" id="S17T2U164">nf</span>+<span class="var type1" id="S21T5U165">fx</span></span>,<span class="mxinfo" id="T2:U63"><span class="var type1" id="S14T2U166">lw</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,99" id="srcline99"> 99</a></span><span class="line"><span class="mxinfo" id="T27:U65"><span class="var type1" id="S24T27U169">indf</span>= <span class="mxinfo" id="T27:U67"><span class="mxinfo" id="T2:U68"><span class="var type1" id="S7T2U171">inc</span></span>*<span class="mxinfo" id="T27:U70">(0:(<span class="var type1" id="S17T2U178">nf</span>-1)).'</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,100" id="srcline100">100</a></span><span class="line"><span class="mxinfo" id="T28:U72"><span class="var type1" id="S25T28U182">inds</span> = (<span class="mxinfo" id="T28:U74">1:<span class="var type1" id="S14T2U186">lw</span></span>)</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,101" id="srcline101">101</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S21T5U189">fx</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,102" id="srcline102">102</a></span><span class="line">    <span class="var type0" id="S2T0U193">f</span>(1:<span class="var type0" id="S17T0U196">nf</span>,:) = <span class="var type0" id="S5T0U199">x</span>(<span class="var type0" id="S24T0U202">indf</span>(:,ones(1,<span class="var type0" id="S14T0U207">lw</span>))+<span class="var type0" id="S25T0U209">inds</span>(ones(<span class="var type0" id="S17T0U212">nf</span>,1),:));</span></span>
<span class="srcline"><span class="lineno"><a href="43,103" id="srcline103">103</a></span><span class="line">    <span class="keyword">if</span> any(<span class="var type0" id="S8T0U220">m</span>==<span class="string">'r'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,104" id="srcline104">104</a></span><span class="line">        <span class="var type0" id="S26T0U224">ix</span>=1+mod(<span class="var type0" id="S17T0U231">nf</span>*<span class="var type0" id="S7T0U232">inc</span>:<span class="var type0" id="S17T0U236">nf</span>*<span class="var type0" id="S7T0U237">inc</span>+<span class="var type0" id="S14T0U238">lw</span>-1,2*<span class="var type0" id="S9T0U242">nx</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,105" id="srcline105">105</a></span><span class="line">        <span class="var type0" id="S2T0U246">f</span>(<span class="var type0" id="S17T0U248">nf</span>+1,:)=<span class="var type0" id="S5T0U252">x</span>(<span class="var type0" id="S26T0U254">ix</span>+(<span class="var type0" id="S26T0U258">ix</span>&gt;<span class="var type0" id="S9T0U259">nx</span>).*(2*<span class="var type0" id="S9T0U265">nx</span>+1-2*<span class="var type0" id="S26T0U269">ix</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="43,106" id="srcline106">106</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,107" id="srcline107">107</a></span><span class="line">        <span class="var type0" id="S2T0U274">f</span>(<span class="var type0" id="S17T0U276">nf</span>+1,1:<span class="var type0" id="S9T0U281">nx</span>-<span class="var type0" id="S17T0U283">nf</span>*<span class="var type0" id="S7T0U284">inc</span>)=<span class="var type0" id="S5T0U286">x</span>(1+<span class="var type0" id="S17T0U291">nf</span>*<span class="var type0" id="S7T0U292">inc</span>:<span class="var type0" id="S9T0U293">nx</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,108" id="srcline108">108</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,109" id="srcline109">109</a></span><span class="line">    <span class="var type0" id="S17T0U296">nf</span>=size(<span class="var type0" id="S2T0U299">f</span>,1);</span></span>
<span class="srcline"><span class="lineno"><a href="43,110" id="srcline110">110</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,111" id="srcline111">111</a></span><span class="line">    <span class="mxinfo" id="T29:U77"><span class="var type1" id="S2T29U305">f</span>(:) = <span class="mxinfo" id="T29:U79"><span class="var type1" id="S5T1U308">x</span>(<span class="mxinfo" id="T29:U81"><span class="mxinfo" id="T29:U82"><span class="var type1" id="S24T27U311">indf</span>(:,<span class="mxinfo" id="T28:U84">ones(<span class="mxinfo" id="T2:U85">1</span>,<span class="mxinfo" id="T2:U86"><span class="var type1" id="S14T2U316">lw</span></span>)</span>)</span>+<span class="mxinfo" id="T29:U88"><span class="var type1" id="S25T28U318">inds</span>(<span class="mxinfo" id="T27:U90">ones(<span class="mxinfo" id="T2:U91"><span class="var type1" id="S17T2U321">nf</span></span>,1)</span>,:)</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,112" id="srcline112">112</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,113" id="srcline113">113</a></span><span class="line"><span class="keyword">if</span> (<span class="var type1" id="S13T2U328">nwin</span> &gt; 1)   <span class="comment">% if we have a non-unity window</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,114" id="srcline114">114</a></span><span class="line">    <span class="mxinfo" id="T29:U94"><span class="var type1" id="S2T29U332">f</span> = <span class="mxinfo" id="T29:U96"><span class="var type1" id="S2T29U334">f</span> .* <span class="mxinfo" id="T29:U98"><span class="var type1" id="S4T28U336">w</span>(<span class="mxinfo" id="T27:U100">ones(<span class="mxinfo" id="T2:U101"><span class="var type1" id="S17T2U339">nf</span></span>,1)</span>,:)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="43,115" id="srcline115">115</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,116" id="srcline116">116</a></span><span class="line"><span class="keyword">if</span> nargout&gt;1</span></span>
<span class="srcline"><span class="lineno"><a href="43,117" id="srcline117">117</a></span><span class="line">    <span class="keyword">if</span> any(<span class="var type0" id="S8T0U353">m</span>==<span class="string">'E'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,118" id="srcline118">118</a></span><span class="line">        <span class="var type0" id="S30T0U357">t0</span>=sum((1:<span class="var type0" id="S14T0U365">lw</span>).*<span class="var type0" id="S4T0U367">w</span>.^2)/sum(<span class="var type0" id="S4T0U372">w</span>.^2);</span></span>
<span class="srcline"><span class="lineno"><a href="43,119" id="srcline119">119</a></span><span class="line">    <span class="keyword">elseif</span> any(<span class="var type0" id="S8T0U378">m</span>==<span class="string">'A'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="43,120" id="srcline120">120</a></span><span class="line">        <span class="var type0" id="S30T0U382">t0</span>=sum((1:<span class="var type0" id="S14T0U390">lw</span>).*<span class="var type0" id="S4T0U391">w</span>)/sum(<span class="var type0" id="S4T0U394">w</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="43,121" id="srcline121">121</a></span><span class="line">    <span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,122" id="srcline122">122</a></span><span class="line">        <span class="var type0" id="S30T0U398">t0</span>=(1+<span class="var type0" id="S14T0U403">lw</span>)/2;</span></span>
<span class="srcline"><span class="lineno"><a href="43,123" id="srcline123">123</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="43,124" id="srcline124">124</a></span><span class="line">    <span class="var type0" id="S3T0U407">t</span>=<span class="var type0" id="S30T0U409">t0</span>+<span class="var type0" id="S7T0U411">inc</span>*(0:(<span class="var type0" id="S17T0U418">nf</span>-1)).';</span></span>
<span class="srcline"><span class="lineno"><a href="43,125" id="srcline125">125</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="43,126" id="srcline126">126</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="43,127" id="srcline127">127</a></span><span class="line"></span></span>
</pre>
