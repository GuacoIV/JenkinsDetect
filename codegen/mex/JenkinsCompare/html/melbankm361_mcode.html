<!-- saved from url=(0014)about:internet -->
<pre class="code">
<span class="srcline"><span class="lineno"><a href="93,1" id="srcline1">  1</a></span><span class="line"><span class="keyword">function</span> [<span class="var type1" id="S2T18U3">x</span>,<span class="var type1" id="S3T41U4">mc</span>,<span class="var type1" id="S4T2U5">mn</span>,<span class="var type0" id="S5T0U6">mx</span>]=melbankm(<span class="var type1" id="S6T2U9">p</span>,<span class="mxinfo" id="T2:U5"><span class="var type2" id="S7T2V2U10">n</span></span>,<span class="var type1" id="S8T2U11">fs</span>,<span class="mxinfo" id="T2:U8"><span class="var type2" id="S9T2V3U12">fl</span></span>,<span class="mxinfo" id="T2:U10"><span class="var type2" id="S10T2V4U13">fh</span></span>,<span class="mxinfo" id="T10:U12"><span class="var type2" id="S11T10V5U14">w</span></span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,2" id="srcline2">  2</a></span><span class="line"><span class="comment">%MELBANKM determine matrix for a mel/erb/bark-spaced filterbank [X,MN,MX]=(P,N,FS,FL,FH,W)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,3" id="srcline3">  3</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,4" id="srcline4">  4</a></span><span class="line"><span class="comment">% Inputs:</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,5" id="srcline5">  5</a></span><span class="line"><span class="comment">%       p   number of filters in filterbank or the filter spacing in k-mel/bark/erb [ceil(4.6*log10(fs))]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,6" id="srcline6">  6</a></span><span class="line"><span class="comment">%       n   length of fft</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,7" id="srcline7">  7</a></span><span class="line"><span class="comment">%       fs  sample rate in Hz</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,8" id="srcline8">  8</a></span><span class="line"><span class="comment">%       fl  low end of the lowest filter as a fraction of fs [default = 0]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,9" id="srcline9">  9</a></span><span class="line"><span class="comment">%       fh  high end of highest filter as a fraction of fs [default = 0.5]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,10" id="srcline10"> 10</a></span><span class="line"><span class="comment">%       w   any sensible combination of the following:</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,11" id="srcline11"> 11</a></span><span class="line"><span class="comment">%             'b' = bark scale instead of mel</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,12" id="srcline12"> 12</a></span><span class="line"><span class="comment">%             'e' = erb-rate scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,13" id="srcline13"> 13</a></span><span class="line"><span class="comment">%             'l' = log10 Hz frequency scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,14" id="srcline14"> 14</a></span><span class="line"><span class="comment">%             'f' = linear frequency scale</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,15" id="srcline15"> 15</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,16" id="srcline16"> 16</a></span><span class="line"><span class="comment">%             'c' = fl/fh specify centre of low and high filters</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,17" id="srcline17"> 17</a></span><span class="line"><span class="comment">%             'h' = fl/fh are in Hz instead of fractions of fs</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,18" id="srcline18"> 18</a></span><span class="line"><span class="comment">%             'H' = fl/fh are in mel/erb/bark/log10</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,19" id="srcline19"> 19</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,20" id="srcline20"> 20</a></span><span class="line"><span class="comment">%             't' = triangular shaped filters in mel/erb/bark domain (default)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,21" id="srcline21"> 21</a></span><span class="line"><span class="comment">%             'n' = hanning shaped filters in mel/erb/bark domain</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,22" id="srcline22"> 22</a></span><span class="line"><span class="comment">%             'm' = hamming shaped filters in mel/erb/bark domain</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,23" id="srcline23"> 23</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,24" id="srcline24"> 24</a></span><span class="line"><span class="comment">%             'z' = highest and lowest filters taper down to zero [default]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,25" id="srcline25"> 25</a></span><span class="line"><span class="comment">%             'y' = lowest filter remains at 1 down to 0 frequency and</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,26" id="srcline26"> 26</a></span><span class="line"><span class="comment">%                   highest filter remains at 1 up to nyquist freqency</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,27" id="srcline27"> 27</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,28" id="srcline28"> 28</a></span><span class="line"><span class="comment">%             'u' = scale filters to sum to unity</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,29" id="srcline29"> 29</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,30" id="srcline30"> 30</a></span><span class="line"><span class="comment">%             's' = single-sided: do not double filters to account for negative frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,31" id="srcline31"> 31</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,32" id="srcline32"> 32</a></span><span class="line"><span class="comment">%             'g' = plot idealized filters [default if no output arguments present]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,33" id="srcline33"> 33</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,34" id="srcline34"> 34</a></span><span class="line"><span class="comment">% Note that the filter shape (triangular, hamming etc) is defined in the mel (or erb etc) domain.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,35" id="srcline35"> 35</a></span><span class="line"><span class="comment">% Some people instead define an asymmetric triangular filter in the frequency domain.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,36" id="srcline36"> 36</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,37" id="srcline37"> 37</a></span><span class="line"><span class="comment">%              If 'ty' or 'ny' is specified, the total power in the fft is preserved.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,38" id="srcline38"> 38</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,39" id="srcline39"> 39</a></span><span class="line"><span class="comment">% Outputs:  x     a sparse matrix containing the filterbank amplitudes</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,40" id="srcline40"> 40</a></span><span class="line"><span class="comment">%                 If the mn and mx outputs are given then size(x)=[p,mx-mn+1]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,41" id="srcline41"> 41</a></span><span class="line"><span class="comment">%                 otherwise size(x)=[p,1+floor(n/2)]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,42" id="srcline42"> 42</a></span><span class="line"><span class="comment">%                 Note that the peak filter values equal 2 to account for the power</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,43" id="srcline43"> 43</a></span><span class="line"><span class="comment">%                 in the negative FFT frequencies.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,44" id="srcline44"> 44</a></span><span class="line"><span class="comment">%           mc    the filterbank centre frequencies in mel/erb/bark</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,45" id="srcline45"> 45</a></span><span class="line"><span class="comment">%           mn    the lowest fft bin with a non-zero coefficient</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,46" id="srcline46"> 46</a></span><span class="line"><span class="comment">%           mx    the highest fft bin with a non-zero coefficient</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,47" id="srcline47"> 47</a></span><span class="line"><span class="comment">%                 Note: you must specify both or neither of mn and mx.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,48" id="srcline48"> 48</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,49" id="srcline49"> 49</a></span><span class="line"><span class="comment">% Examples of use:</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,50" id="srcline50"> 50</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,51" id="srcline51"> 51</a></span><span class="line"><span class="comment">% (a) Calcuate the Mel-frequency Cepstral Coefficients</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,52" id="srcline52"> 52</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,53" id="srcline53"> 53</a></span><span class="line"><span class="comment">%       f=rfft(s);                  % rfft() returns only 1+floor(n/2) coefficients</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,54" id="srcline54"> 54</a></span><span class="line"><span class="comment">%       x=melbankm(p,n,fs);         % n is the fft length, p is the number of filters wanted</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,55" id="srcline55"> 55</a></span><span class="line"><span class="comment">%       z=log(x*abs(f).^2);         % multiply x by the power spectrum</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,56" id="srcline56"> 56</a></span><span class="line"><span class="comment">%       c=dct(z);                   % take the DCT</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,57" id="srcline57"> 57</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,58" id="srcline58"> 58</a></span><span class="line"><span class="comment">% (b) Calcuate the Mel-frequency Cepstral Coefficients efficiently</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,59" id="srcline59"> 59</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,60" id="srcline60"> 60</a></span><span class="line"><span class="comment">%       f=fft(s);                        % n is the fft length, p is the number of filters wanted</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,61" id="srcline61"> 61</a></span><span class="line"><span class="comment">%       [x,mc,na,nb]=melbankm(p,n,fs);   % na:nb gives the fft bins that are needed</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,62" id="srcline62"> 62</a></span><span class="line"><span class="comment">%       z=log(x*(f(na:nb)).*conj(f(na:nb)));</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,63" id="srcline63"> 63</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,64" id="srcline64"> 64</a></span><span class="line"><span class="comment">% (c) Plot the calculated filterbanks</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,65" id="srcline65"> 65</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,66" id="srcline66"> 66</a></span><span class="line"><span class="comment">%      plot((0:floor(n/2))*fs/n,melbankm(p,n,fs)')   % fs=sample frequency</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,67" id="srcline67"> 67</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,68" id="srcline68"> 68</a></span><span class="line"><span class="comment">% (d) Plot the idealized filterbanks (without output sampling)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,69" id="srcline69"> 69</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,70" id="srcline70"> 70</a></span><span class="line"><span class="comment">%      melbankm(p,n,fs);</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,71" id="srcline71"> 71</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,72" id="srcline72"> 72</a></span><span class="line"><span class="comment">% References:</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,73" id="srcline73"> 73</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,74" id="srcline74"> 74</a></span><span class="line"><span class="comment">% [1] S. S. Stevens, J. Volkman, and E. B. Newman. A scale for the measurement</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,75" id="srcline75"> 75</a></span><span class="line"><span class="comment">%     of the psychological magnitude of pitch. J. Acoust Soc Amer, 8: 185–19, 1937.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,76" id="srcline76"> 76</a></span><span class="line"><span class="comment">% [2] S. Davis and P. Mermelstein. Comparison of parametric representations for</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,77" id="srcline77"> 77</a></span><span class="line"><span class="comment">%     monosyllabic word recognition in continuously spoken sentences.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,78" id="srcline78"> 78</a></span><span class="line"><span class="comment">%     IEEE Trans Acoustics Speech and Signal Processing, 28 (4): 357–366, Aug. 1980.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,79" id="srcline79"> 79</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="93,80" id="srcline80"> 80</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="93,81" id="srcline81"> 81</a></span><span class="line"><span class="comment">%      Copyright (C) Mike Brookes 1997-2009</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,82" id="srcline82"> 82</a></span><span class="line"><span class="comment">%      Version: $Id: melbankm.m 713 2011-10-16 14:45:43Z dmb $</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,83" id="srcline83"> 83</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,84" id="srcline84"> 84</a></span><span class="line"><span class="comment">%   VOICEBOX is a MATLAB toolbox for speech processing.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,85" id="srcline85"> 85</a></span><span class="line"><span class="comment">%   Home page: http://www.ee.ic.ac.uk/hp/staff/dmb/voicebox/voicebox.html</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,86" id="srcline86"> 86</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,87" id="srcline87"> 87</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,88" id="srcline88"> 88</a></span><span class="line"><span class="comment">%   This program is free software; you can redistribute it and/or modify</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,89" id="srcline89"> 89</a></span><span class="line"><span class="comment">%   it under the terms of the GNU General Public License as published by</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,90" id="srcline90"> 90</a></span><span class="line"><span class="comment">%   the Free Software Foundation; either version 2 of the License, or</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,91" id="srcline91"> 91</a></span><span class="line"><span class="comment">%   (at your option) any later version.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,92" id="srcline92"> 92</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,93" id="srcline93"> 93</a></span><span class="line"><span class="comment">%   This program is distributed in the hope that it will be useful,</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,94" id="srcline94"> 94</a></span><span class="line"><span class="comment">%   but WITHOUT ANY WARRANTY; without even the implied warranty of</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,95" id="srcline95"> 95</a></span><span class="line"><span class="comment">%   MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,96" id="srcline96"> 96</a></span><span class="line"><span class="comment">%   GNU General Public License for more details.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,97" id="srcline97"> 97</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,98" id="srcline98"> 98</a></span><span class="line"><span class="comment">%   You can obtain a copy of the GNU General Public License from</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,99" id="srcline99"> 99</a></span><span class="line"><span class="comment">%   http://www.gnu.org/copyleft/gpl.html or by writing to</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,100" id="srcline100">100</a></span><span class="line"><span class="comment">%   Free Software Foundation, Inc.,675 Mass Ave, Cambridge, MA 02139, USA.</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,101" id="srcline101">101</a></span><span class="line"><span class="comment">%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,102" id="srcline102">102</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="93,103" id="srcline103">103</a></span><span class="line"><span class="comment">% Note "FFT bin_0" assumes DC = bin 0 whereas "FFT bin_1" means DC = bin 1</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,104" id="srcline104">104</a></span><span class="line">eml.extrinsic(<span class="string">'sparse'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="93,105" id="srcline105">105</a></span><span class="line"><span class="keyword">if</span> nargin &lt; 6</span></span>
<span class="srcline"><span class="lineno"><a href="93,106" id="srcline106">106</a></span><span class="line">    <span class="var type0" id="S11T0U29">w</span>=<span class="string">'tz'</span>; <span class="comment">% default options</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,107" id="srcline107">107</a></span><span class="line">    <span class="keyword">if</span> nargin &lt; 5</span></span>
<span class="srcline"><span class="lineno"><a href="93,108" id="srcline108">108</a></span><span class="line">        <span class="var type0" id="S10T0U39">fh</span>=0.5; <span class="comment">% max freq is the nyquist</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,109" id="srcline109">109</a></span><span class="line">        <span class="keyword">if</span> nargin &lt; 4</span></span>
<span class="srcline"><span class="lineno"><a href="93,110" id="srcline110">110</a></span><span class="line">            <span class="var type0" id="S9T0U49">fl</span>=0; <span class="comment">% min freq is DC</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,111" id="srcline111">111</a></span><span class="line">        <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,112" id="srcline112">112</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,113" id="srcline113">113</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,114" id="srcline114">114</a></span><span class="line"><span class="mxinfo" id="T2:U14"><span class="var type1" id="S14T2U53">sfact</span>=<span class="mxinfo" id="T2:U16">2-any(<span class="var type1" id="S11T10U59">w</span>==<span class="string">'s'</span>)</span></span>;   <span class="comment">% 1 if single sided else 2</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,115" id="srcline115">115</a></span><span class="line"><span class="mxinfo" id="T10:U18"><span class="var type1" id="S16T10U63">wr</span>=<span class="mxinfo" id="T10:U20"><span class="string">' '</span></span></span>;   <span class="comment">% default warping is mel</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,116" id="srcline116">116</a></span><span class="line"><span class="keyword">for</span> <span class="var type1" id="S17T2U67">i</span>=<span class="mxinfo" id="T2:U22">1:length(<span class="var type1" id="S11T10U72">w</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,117" id="srcline117">117</a></span><span class="line">    <span class="keyword">if</span> any(<span class="var type1" id="S11T10U79">w</span>(<span class="var type1" id="S17T2U80">i</span>)==<span class="string">'lebf'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="93,118" id="srcline118">118</a></span><span class="line">        <span class="var type0" id="S16T0U84">wr</span>=<span class="var type0" id="S11T0U86">w</span>(<span class="var type0" id="S17T0U87">i</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="93,119" id="srcline119">119</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,120" id="srcline120">120</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,121" id="srcline121">121</a></span><span class="line"><span class="keyword">if</span> any(<span class="var type1" id="S11T10U94">w</span>==<span class="string">'h'</span>) || any(<span class="var type1" id="S11T10U99">w</span>==<span class="string">'H'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,122" id="srcline122">122</a></span><span class="line">    <span class="var type0" id="S19T0U103">mflh</span>=[<span class="var type0" id="S9T0U106">fl</span> <span class="var type0" id="S10T0U107">fh</span>];</span></span>
<span class="srcline"><span class="lineno"><a href="93,123" id="srcline123">123</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,124" id="srcline124">124</a></span><span class="line">    <span class="mxinfo" id="T32:U28"><span class="var type1" id="S19T32U111">mflh</span>=<span class="mxinfo" id="T32:U30"><span class="mxinfo" id="T32:U31">[<span class="var type1" id="S9T2U115">fl</span> <span class="var type1" id="S10T2U116">fh</span>]</span>*<span class="var type1" id="S8T2U117">fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,125" id="srcline125">125</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,126" id="srcline126">126</a></span><span class="line"><span class="keyword">if</span> ~any(<span class="var type1" id="S11T10U124">w</span>==<span class="string">'H'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,127" id="srcline127">127</a></span><span class="line">    <span class="keyword">switch</span> <span class="var type1" id="S16T10U127">wr</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,128" id="srcline128">128</a></span><span class="line">                    <span class="keyword">case</span> <span class="string">'f'</span>       <span class="comment">% no transformation</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,129" id="srcline129">129</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'l'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,130" id="srcline130">130</a></span><span class="line">            <span class="keyword">if</span> <span class="var type0" id="S9T0U135">fl</span>&lt;=0</span></span>
<span class="srcline"><span class="lineno"><a href="93,131" id="srcline131">131</a></span><span class="line">                error(<span class="string">'Low frequency limit must be &gt;0 for l option'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="93,132" id="srcline132">132</a></span><span class="line">            <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,133" id="srcline133">133</a></span><span class="line">            <span class="var type0" id="S19T0U143">mflh</span>=log10(<span class="var type0" id="S19T0U146">mflh</span>);       <span class="comment">% convert frequency limits into log10 Hz</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,134" id="srcline134">134</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'e'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,135" id="srcline135">135</a></span><span class="line">            <span class="var type0" id="S19T0U151">mflh</span>=frq2erb(<span class="var type0" id="S19T0U154">mflh</span>);       <span class="comment">% convert frequency limits into erb-rate</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,136" id="srcline136">136</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'b'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,137" id="srcline137">137</a></span><span class="line">            <span class="var type0" id="S19T0U159">mflh</span>=frq2bark(<span class="var type0" id="S19T0U162">mflh</span>);       <span class="comment">% convert frequency limits into bark</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,138" id="srcline138">138</a></span><span class="line">        <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,139" id="srcline139">139</a></span><span class="line">            <span class="mxinfo" id="T32:U37"><span class="var type1" id="S19T32U166">mflh</span>=<span class="mxinfo" id="T32:U39"><span class="fcn" id="F375N6:B168">frq2mel</span>(<span class="var type1" id="S19T32U169">mflh</span>)</span></span>;       <span class="comment">% convert frequency limits into mel</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,140" id="srcline140">140</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,141" id="srcline141">141</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,142" id="srcline142">142</a></span><span class="line"><span class="mxinfo" id="T2:U41"><span class="var type1" id="S25T2U172">melrng</span>=<span class="mxinfo" id="T2:U43"><span class="var type1" id="S19T32U174">mflh</span>*<span class="mxinfo" id="T65:U45">(-1:2:1)'</span></span></span>;          <span class="comment">% mel range</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,143" id="srcline143">143</a></span><span class="line"><span class="mxinfo" id="T2:U46"><span class="var type1" id="S26T2U185">fn2</span>=<span class="mxinfo" id="T2:U48">floor(<span class="var type1" id="S7T2U189">n</span>/2)</span></span>;     <span class="comment">% bin index of highest positive frequency (Nyquist if n is even)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,144" id="srcline144">144</a></span><span class="line"><span class="keyword">if</span> isempty(<span class="var type1" id="S6T2U195">p</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,145" id="srcline145">145</a></span><span class="line">    <span class="var type0" id="S6T0U198">p</span>=ceil(4.6*log10(<span class="var type0" id="S8T0U205">fs</span>));         <span class="comment">% default number of filters</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,146" id="srcline146">146</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,147" id="srcline147">147</a></span><span class="line"><span class="keyword">if</span> any(<span class="var type1" id="S11T10U211">w</span>==<span class="string">'c'</span>)              <span class="comment">% c option: specify fiter centres not edges</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,148" id="srcline148">148</a></span><span class="line"><span class="keyword">if</span> <span class="var type0" id="S6T0U216">p</span>&lt;1</span></span>
<span class="srcline"><span class="lineno"><a href="93,149" id="srcline149">149</a></span><span class="line">    <span class="var type0" id="S6T0U220">p</span>=round(<span class="var type0" id="S25T0U225">melrng</span>/(<span class="var type0" id="S6T0U228">p</span>*1000))+1;</span></span>
<span class="srcline"><span class="lineno"><a href="93,150" id="srcline150">150</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,151" id="srcline151">151</a></span><span class="line"><span class="var type0" id="S31T0U233">melinc</span>=<span class="var type0" id="S25T0U235">melrng</span>/(<span class="var type0" id="S6T0U238">p</span>-1);</span></span>
<span class="srcline"><span class="lineno"><a href="93,152" id="srcline152">152</a></span><span class="line"><span class="var type0" id="S19T0U242">mflh</span>=<span class="var type0" id="S19T0U244">mflh</span>+(-1:2:1)*<span class="var type0" id="S31T0U253">melinc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,153" id="srcline153">153</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,154" id="srcline154">154</a></span><span class="line">    <span class="keyword">if</span> <span class="mxinfo" id="T7:U52"><span class="var type1" id="S6T2U258">p</span>&lt;<span class="mxinfo" id="T2:U54">1</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="93,155" id="srcline155">155</a></span><span class="line">    <span class="mxinfo" id="T2:U55"><span class="var type1" id="S6T2U262">p</span>=<span class="mxinfo" id="T2:U57"><span class="mxinfo" id="T2:U58">round(<span class="mxinfo" id="T2:U59"><span class="var type1" id="S25T2U267">melrng</span>/(<span class="mxinfo" id="T2:U61"><span class="var type1" id="S6T2U270">p</span>*<span class="mxinfo" id="T2:U63">1000</span></span>)</span>)</span>-<span class="mxinfo" id="T2:U64">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,156" id="srcline156">156</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,157" id="srcline157">157</a></span><span class="line"><span class="mxinfo" id="T2:U65"><span class="var type1" id="S31T2U275">melinc</span>=<span class="mxinfo" id="T2:U67"><span class="var type1" id="S25T2U277">melrng</span>/(<span class="mxinfo" id="T2:U69"><span class="var type1" id="S6T2U280">p</span>+<span class="mxinfo" id="T2:U71">1</span></span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,158" id="srcline158">158</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,159" id="srcline159">159</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="93,160" id="srcline160">160</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,161" id="srcline161">161</a></span><span class="line"><span class="comment">% Calculate the FFT bins corresponding to [filter#1-low filter#1-mid filter#p-mid filter#p-high]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,162" id="srcline162">162</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,163" id="srcline163">163</a></span><span class="line"><span class="keyword">switch</span> <span class="var type1" id="S16T10U283">wr</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,164" id="srcline164">164</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'f'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,165" id="srcline165">165</a></span><span class="line">        <span class="var type0" id="S32T0U288">blim</span>=(<span class="var type0" id="S19T0U294">mflh</span>(1)+[0 1 <span class="var type0" id="S6T0U301">p</span> <span class="var type0" id="S6T0U303">p</span>+1]*<span class="var type0" id="S31T0U305">melinc</span>)*<span class="var type0" id="S7T0U306">n</span>/<span class="var type0" id="S8T0U307">fs</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,166" id="srcline166">166</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'l'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,167" id="srcline167">167</a></span><span class="line">        <span class="var type0" id="S32T0U312">blim</span>=10.^(<span class="var type0" id="S19T0U320">mflh</span>(1)+[0 1 <span class="var type0" id="S6T0U327">p</span> <span class="var type0" id="S6T0U329">p</span>+1]*<span class="var type0" id="S31T0U331">melinc</span>)*<span class="var type0" id="S7T0U332">n</span>/<span class="var type0" id="S8T0U333">fs</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,168" id="srcline168">168</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'e'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,169" id="srcline169">169</a></span><span class="line">        <span class="var type0" id="S32T0U338">blim</span>=erb2frq(<span class="var type0" id="S19T0U345">mflh</span>(1)+[0 1 <span class="var type0" id="S6T0U352">p</span> <span class="var type0" id="S6T0U354">p</span>+1]*<span class="var type0" id="S31T0U356">melinc</span>)*<span class="var type0" id="S7T0U357">n</span>/<span class="var type0" id="S8T0U358">fs</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,170" id="srcline170">170</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'b'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,171" id="srcline171">171</a></span><span class="line">        <span class="var type0" id="S32T0U363">blim</span>=bark2frq(<span class="var type0" id="S19T0U370">mflh</span>(1)+[0 1 <span class="var type0" id="S6T0U377">p</span> <span class="var type0" id="S6T0U379">p</span>+1]*<span class="var type0" id="S31T0U381">melinc</span>)*<span class="var type0" id="S7T0U382">n</span>/<span class="var type0" id="S8T0U383">fs</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,172" id="srcline172">172</a></span><span class="line">    <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,173" id="srcline173">173</a></span><span class="line">        <span class="mxinfo" id="T67:U73"><span class="var type1" id="S32T67U387">blim</span>=<span class="mxinfo" id="T67:U75"><span class="mxinfo" id="T67:U76"><span class="mxinfo" id="T67:U77"><span class="fcn" id="F414N9:B391">mel2frq</span>(<span class="mxinfo" id="T67:U78"><span class="mxinfo" id="T2:U79"><span class="var type1" id="S19T32U394">mflh</span>(<span class="mxinfo" id="T2:U81">1</span>)</span>+<span class="mxinfo" id="T67:U82"><span class="mxinfo" id="T67:U83">[<span class="mxinfo" id="T2:U84">0</span> <span class="mxinfo" id="T2:U85">1</span> <span class="var type1" id="S6T2U401">p</span> <span class="mxinfo" id="T2:U87"><span class="var type1" id="S6T2U403">p</span>+<span class="mxinfo" id="T2:U89">1</span></span>]</span>*<span class="var type1" id="S31T2U405">melinc</span></span></span>)</span>*<span class="mxinfo" id="T2:U91"><span class="var type1" id="S7T2U406">n</span></span></span>/<span class="var type1" id="S8T2U407">fs</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,174" id="srcline174">174</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,175" id="srcline175">175</a></span><span class="line"><span class="mxinfo" id="T41:U94"><span class="var type1" id="S3T41U410">mc</span>=<span class="mxinfo" id="T41:U96"><span class="mxinfo" id="T2:U97"><span class="var type1" id="S19T32U413">mflh</span>(<span class="mxinfo" id="T2:U99">1</span>)</span>+<span class="mxinfo" id="T41:U100">(<span class="mxinfo" id="T41:U101">1:<span class="var type1" id="S6T2U419">p</span></span>)*<span class="var type1" id="S31T2U420">melinc</span></span></span></span>;    <span class="comment">% mel centre frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,176" id="srcline176">176</a></span><span class="line"><span class="mxinfo" id="T2:U104"><span class="var type1" id="S36T2U423">b1</span>=<span class="mxinfo" id="T2:U106"><span class="mxinfo" id="T2:U107">floor(<span class="mxinfo" id="T2:U108"><span class="var type1" id="S32T67U428">blim</span>(<span class="mxinfo" id="T2:U110">1</span>)</span>)</span>+<span class="mxinfo" id="T2:U111">1</span></span></span>;            <span class="comment">% lowest FFT bin_0 required might be negative)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,177" id="srcline177">177</a></span><span class="line"><span class="mxinfo" id="T2:U112"><span class="var type1" id="S37T2U433">b4</span>=<span class="mxinfo" id="T2:U114">min(<span class="mxinfo" id="T2:U115"><span class="var type1" id="S26T2U436">fn2</span></span>,<span class="mxinfo" id="T2:U117"><span class="mxinfo" id="T2:U118">ceil(<span class="mxinfo" id="T2:U119"><span class="var type1" id="S32T67U441">blim</span>(<span class="mxinfo" id="T2:U121">4</span>)</span>)</span>-<span class="mxinfo" id="T2:U122">1</span></span>)</span></span>;    <span class="comment">% highest FFT bin_0 required</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,178" id="srcline178">178</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,179" id="srcline179">179</a></span><span class="line"><span class="comment">% now map all the useful FFT bins_0 to filter1 centres</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,180" id="srcline180">180</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,181" id="srcline181">181</a></span><span class="line"><span class="keyword">switch</span> <span class="var type1" id="S16T10U445">wr</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,182" id="srcline182">182</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'f'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,183" id="srcline183">183</a></span><span class="line">        <span class="var type0" id="S39T0U450">pf</span>=((<span class="var type0" id="S36T0U458">b1</span>:<span class="var type0" id="S37T0U459">b4</span>)*<span class="var type0" id="S8T0U460">fs</span>/<span class="var type0" id="S7T0U461">n</span>-<span class="var type0" id="S19T0U463">mflh</span>(1))/<span class="var type0" id="S31T0U465">melinc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,184" id="srcline184">184</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'l'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,185" id="srcline185">185</a></span><span class="line">        <span class="var type0" id="S39T0U470">pf</span>=(log10((<span class="var type0" id="S36T0U480">b1</span>:<span class="var type0" id="S37T0U481">b4</span>)*<span class="var type0" id="S8T0U482">fs</span>/<span class="var type0" id="S7T0U483">n</span>)-<span class="var type0" id="S19T0U485">mflh</span>(1))/<span class="var type0" id="S31T0U487">melinc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,186" id="srcline186">186</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'e'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,187" id="srcline187">187</a></span><span class="line">        <span class="var type0" id="S39T0U492">pf</span>=(frq2erb((<span class="var type0" id="S36T0U502">b1</span>:<span class="var type0" id="S37T0U503">b4</span>)*<span class="var type0" id="S8T0U504">fs</span>/<span class="var type0" id="S7T0U505">n</span>)-<span class="var type0" id="S19T0U507">mflh</span>(1))/<span class="var type0" id="S31T0U509">melinc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,188" id="srcline188">188</a></span><span class="line">    <span class="keyword">case</span> <span class="string">'b'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,189" id="srcline189">189</a></span><span class="line">        <span class="var type0" id="S39T0U514">pf</span>=(frq2bark((<span class="var type0" id="S36T0U524">b1</span>:<span class="var type0" id="S37T0U525">b4</span>)*<span class="var type0" id="S8T0U526">fs</span>/<span class="var type0" id="S7T0U527">n</span>)-<span class="var type0" id="S19T0U529">mflh</span>(1))/<span class="var type0" id="S31T0U531">melinc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,190" id="srcline190">190</a></span><span class="line">    <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,191" id="srcline191">191</a></span><span class="line">        <span class="mxinfo" id="T41:U124"><span class="var type1" id="S39T41U535">pf</span>=<span class="mxinfo" id="T41:U126">(<span class="mxinfo" id="T41:U127"><span class="mxinfo" id="T41:U128"><span class="fcn" id="F455N6:B540">frq2mel</span>(<span class="mxinfo" id="T41:U129"><span class="mxinfo" id="T41:U130">(<span class="mxinfo" id="T41:U131"><span class="var type1" id="S36T2U545">b1</span>:<span class="var type1" id="S37T2U546">b4</span></span>)*<span class="var type1" id="S8T2U547">fs</span></span>/<span class="mxinfo" id="T2:U135"><span class="var type1" id="S7T2U548">n</span></span></span>)</span>-<span class="mxinfo" id="T2:U137"><span class="var type1" id="S19T32U550">mflh</span>(<span class="mxinfo" id="T2:U139">1</span>)</span></span>)/<span class="var type1" id="S31T2U552">melinc</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,192" id="srcline192">192</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,193" id="srcline193">193</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,194" id="srcline194">194</a></span><span class="line"><span class="comment">%  remove any incorrect entries in pf due to rounding errors</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,195" id="srcline195">195</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,196" id="srcline196">196</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U141"><span class="mxinfo" id="T2:U142"><span class="var type1" id="S39T41U557">pf</span>(<span class="mxinfo" id="T2:U144">1</span>)</span>&lt;<span class="mxinfo" id="T2:U145">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="93,197" id="srcline197">197</a></span><span class="line">    <span class="mxinfo" id="T41:U146"><span class="var type1" id="S39T41U563">pf</span>(1)=[]</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,198" id="srcline198">198</a></span><span class="line">    <span class="mxinfo" id="T2:U148"><span class="var type1" id="S36T2U569">b1</span>=<span class="mxinfo" id="T2:U150"><span class="var type1" id="S36T2U571">b1</span>+<span class="mxinfo" id="T2:U152">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,199" id="srcline199">199</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,200" id="srcline200">200</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U153"><span class="mxinfo" id="T2:U154"><span class="var type1" id="S39T41U577">pf</span>(<span class="mxinfo" id="T2:U156">end</span>)</span>&gt;=<span class="mxinfo" id="T2:U157"><span class="var type1" id="S6T2U581">p</span>+<span class="mxinfo" id="T2:U159">1</span></span></span></span></span>
<span class="srcline"><span class="lineno"><a href="93,201" id="srcline201">201</a></span><span class="line">    <span class="mxinfo" id="T41:U160"><span class="var type1" id="S39T41U586">pf</span>(<span class="mxinfo" id="T2:U162">end</span>)=[]</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,202" id="srcline202">202</a></span><span class="line">    <span class="mxinfo" id="T2:U163"><span class="var type1" id="S37T2U593">b4</span>=<span class="mxinfo" id="T2:U165"><span class="var type1" id="S37T2U595">b4</span>-<span class="mxinfo" id="T2:U167">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,203" id="srcline203">203</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,204" id="srcline204">204</a></span><span class="line"><span class="mxinfo" id="T41:U168"><span class="var type1" id="S41T41U599">fp</span>=<span class="mxinfo" id="T41:U170">floor(<span class="var type1" id="S39T41U602">pf</span>)</span></span>;                  <span class="comment">% FFT bin_0 i contributes to filters_1 fp(1+i-b1)+[0 1]</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,205" id="srcline205">205</a></span><span class="line"><span class="mxinfo" id="T41:U172"><span class="var type1" id="S42T41U605">pm</span>=<span class="mxinfo" id="T41:U174"><span class="var type1" id="S39T41U607">pf</span>-<span class="var type1" id="S41T41U608">fp</span></span></span>;                       <span class="comment">% multiplier for upper filter</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,206" id="srcline206">206</a></span><span class="line"><span class="mxinfo" id="T41:U177"><span class="var type1" id="S43T41U611">k2</span>=<span class="mxinfo" id="T41:U179">find(<span class="mxinfo" id="T40:U180"><span class="var type1" id="S41T41U615">fp</span>&gt;<span class="mxinfo" id="T2:U182">0</span></span>,1)</span></span>;   <span class="comment">% FFT bin_1 k2+b1 is the first to contribute to both upper and lower filters</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,207" id="srcline207">207</a></span><span class="line"><span class="mxinfo" id="T41:U183"><span class="var type1" id="S45T41U620">k3</span>=<span class="mxinfo" id="T41:U185">find(<span class="mxinfo" id="T40:U186"><span class="var type1" id="S41T41U624">fp</span>&lt;<span class="var type1" id="S6T2U625">p</span></span>,1,<span class="string">'last'</span>)</span></span>;  <span class="comment">% FFT bin_1 k3+b1 is the last to contribute to both upper and lower filters</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,208" id="srcline208">208</a></span><span class="line"><span class="mxinfo" id="T2:U189"><span class="var type1" id="S46T2U630">k4</span>=<span class="mxinfo" id="T2:U191">numel(<span class="var type1" id="S41T41U633">fp</span>)</span></span>; <span class="comment">% FFT bin_1 k4+b1 is the last to contribute to any filters</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,209" id="srcline209">209</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U193">isempty(<span class="var type1" id="S43T41U638">k2</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,210" id="srcline210">210</a></span><span class="line">    <span class="mxinfo" id="T41:U195"><span class="var type1" id="S43T41U641">k2</span>=<span class="mxinfo" id="T2:U197"><span class="var type1" id="S46T2U643">k4</span>+<span class="mxinfo" id="T2:U199">1</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,211" id="srcline211">211</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,212" id="srcline212">212</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U200">isempty(<span class="var type1" id="S45T41U649">k3</span>)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,213" id="srcline213">213</a></span><span class="line">    <span class="mxinfo" id="T41:U202"><span class="var type1" id="S45T41U652">k3</span>=<span class="mxinfo" id="T2:U204">0</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,214" id="srcline214">214</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,215" id="srcline215">215</a></span><span class="line"><span class="keyword">if</span> any(<span class="var type1" id="S11T10U659">w</span>==<span class="string">'y'</span>)          <span class="comment">% preserve power in FFT</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,216" id="srcline216">216</a></span><span class="line">    <span class="var type0" id="S4T0U663">mn</span>=1; <span class="comment">% lowest fft bin required (1 = DC)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,217" id="srcline217">217</a></span><span class="line">    <span class="var type0" id="S5T0U667">mx</span>=<span class="var type0" id="S26T0U669">fn2</span>+1; <span class="comment">% highest fft bin required (1 = DC)</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,218" id="srcline218">218</a></span><span class="line">    <span class="var type0" id="S48T0U673">r</span>=[ones(1,<span class="var type0" id="S43T0U681">k2</span>+<span class="var type0" id="S36T0U682">b1</span>-1) 1+<span class="var type0" id="S41T0U687">fp</span>(<span class="var type0" id="S43T0U689">k2</span>:<span class="var type0" id="S45T0U690">k3</span>) <span class="var type0" id="S41T0U692">fp</span>(<span class="var type0" id="S43T0U694">k2</span>:<span class="var type0" id="S45T0U695">k3</span>) repmat(<span class="var type0" id="S6T0U698">p</span>,1,<span class="var type0" id="S26T0U703">fn2</span>-<span class="var type0" id="S45T0U704">k3</span>-<span class="var type0" id="S36T0U705">b1</span>+1)]; <span class="comment">% filter number_1</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,219" id="srcline219">219</a></span><span class="line">    <span class="var type0" id="S51T0U709">c</span>=[1:<span class="var type0" id="S43T0U716">k2</span>+<span class="var type0" id="S36T0U717">b1</span>-1 <span class="var type0" id="S43T0U721">k2</span>+<span class="var type0" id="S36T0U722">b1</span>:<span class="var type0" id="S45T0U724">k3</span>+<span class="var type0" id="S36T0U725">b1</span> <span class="var type0" id="S43T0U728">k2</span>+<span class="var type0" id="S36T0U729">b1</span>:<span class="var type0" id="S45T0U731">k3</span>+<span class="var type0" id="S36T0U732">b1</span> <span class="var type0" id="S45T0U736">k3</span>+<span class="var type0" id="S36T0U737">b1</span>+1:<span class="var type0" id="S26T0U740">fn2</span>+1]; <span class="comment">% FFT bin1</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,220" id="srcline220">220</a></span><span class="line">    <span class="var type0" id="S52T0U744">v</span>=[ones(1,<span class="var type0" id="S43T0U752">k2</span>+<span class="var type0" id="S36T0U753">b1</span>-1) <span class="var type0" id="S42T0U756">pm</span>(<span class="var type0" id="S43T0U758">k2</span>:<span class="var type0" id="S45T0U759">k3</span>) 1-<span class="var type0" id="S42T0U763">pm</span>(<span class="var type0" id="S43T0U765">k2</span>:<span class="var type0" id="S45T0U766">k3</span>) ones(1,<span class="var type0" id="S26T0U773">fn2</span>-<span class="var type0" id="S45T0U774">k3</span>-<span class="var type0" id="S36T0U775">b1</span>+1)];</span></span>
<span class="srcline"><span class="lineno"><a href="93,221" id="srcline221">221</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,222" id="srcline222">222</a></span><span class="line">    <span class="mxinfo" id="T41:U206"><span class="var type1" id="S48T41U780">r</span>=<span class="mxinfo" id="T41:U208">[<span class="mxinfo" id="T41:U209"><span class="mxinfo" id="T2:U210">1</span>+<span class="mxinfo" id="T41:U211"><span class="var type1" id="S41T41U786">fp</span>(<span class="mxinfo" id="T2:U213">1</span>:<span class="mxinfo" id="T2:U214">norm(<span class="var type1" id="S45T41U791">k3</span>)</span>)</span></span> <span class="mxinfo" id="T41:U216"><span class="var type1" id="S41T41U793">fp</span>(<span class="mxinfo" id="T2:U218">norm(<span class="var type1" id="S43T41U797">k2</span>)</span>:<span class="var type1" id="S46T2U798">k4</span>)</span>]</span></span>; <span class="comment">% filter number_1</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,223" id="srcline223">223</a></span><span class="line">    <span class="mxinfo" id="T41:U221"><span class="var type1" id="S51T41U801">c</span>=<span class="mxinfo" id="T41:U223">[<span class="mxinfo" id="T41:U224">1:<span class="var type1" id="S45T41U806">k3</span></span> <span class="mxinfo" id="T41:U226"><span class="var type1" id="S43T41U808">k2</span>:<span class="var type1" id="S46T2U809">k4</span></span>]</span></span>; <span class="comment">% FFT bin_1 - b1</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,224" id="srcline224">224</a></span><span class="line">    <span class="mxinfo" id="T41:U229"><span class="var type1" id="S52T41U812">v</span>=<span class="mxinfo" id="T41:U231">[<span class="mxinfo" id="T41:U232"><span class="var type1" id="S42T41U816">pm</span>(<span class="mxinfo" id="T2:U234">1</span>:<span class="mxinfo" id="T2:U235">norm(<span class="var type1" id="S45T41U821">k3</span>)</span>)</span> <span class="mxinfo" id="T41:U237"><span class="mxinfo" id="T2:U238">1</span>-<span class="mxinfo" id="T41:U239"><span class="var type1" id="S42T41U825">pm</span>(<span class="mxinfo" id="T2:U241">norm(<span class="var type1" id="S43T41U829">k2</span>)</span>:<span class="var type1" id="S46T2U830">k4</span>)</span></span>]</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,225" id="srcline225">225</a></span><span class="line">    <span class="mxinfo" id="T2:U244"><span class="var type1" id="S4T2U833">mn</span>=<span class="mxinfo" id="T2:U246"><span class="var type1" id="S36T2U835">b1</span>+<span class="mxinfo" id="T2:U248">1</span></span></span>; <span class="comment">% lowest fft bin_1</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,226" id="srcline226">226</a></span><span class="line">    <span class="mxinfo" id="T2:U249"><span class="var type1" id="S5T2U839">mx</span>=<span class="mxinfo" id="T2:U251"><span class="var type1" id="S37T2U841">b4</span>+<span class="mxinfo" id="T2:U253">1</span></span></span>;  <span class="comment">% highest fft bin_1</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,227" id="srcline227">227</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,228" id="srcline228">228</a></span><span class="line"><span class="keyword">if</span> <span class="mxinfo" id="T7:U254"><span class="var type1" id="S36T2U846">b1</span>&lt;<span class="mxinfo" id="T2:U256">0</span></span></span></span>
<span class="srcline"><span class="lineno"><a href="93,229" id="srcline229">229</a></span><span class="line">    <span class="mxinfo" id="T41:U257"><span class="var type1" id="S51T41U850">c</span>=<span class="mxinfo" id="T41:U259"><span class="mxinfo" id="T41:U260"><span class="mxinfo" id="T41:U261">abs(<span class="mxinfo" id="T41:U262"><span class="mxinfo" id="T41:U263"><span class="var type1" id="S51T41U857">c</span>+<span class="var type1" id="S36T2U858">b1</span></span>-<span class="mxinfo" id="T2:U266">1</span></span>)</span>-<span class="var type1" id="S36T2U860">b1</span></span>+<span class="mxinfo" id="T2:U268">1</span></span></span>;     <span class="comment">% convert negative frequencies into positive</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,230" id="srcline230">230</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,231" id="srcline231">231</a></span><span class="line"><span class="comment">% end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,232" id="srcline232">232</a></span><span class="line"><span class="keyword">if</span> any(<span class="var type1" id="S11T10U867">w</span>==<span class="string">'n'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,233" id="srcline233">233</a></span><span class="line">    <span class="var type0" id="S52T0U871">v</span>=0.5-0.5*cos(<span class="var type0" id="S52T0U879">v</span>*pi);      <span class="comment">% convert triangles to Hanning</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,234" id="srcline234">234</a></span><span class="line"><span class="keyword">elseif</span> any(<span class="var type1" id="S11T10U886">w</span>==<span class="string">'m'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,235" id="srcline235">235</a></span><span class="line">    <span class="var type0" id="S52T0U890">v</span>=0.5-0.46/1.08*cos(<span class="var type0" id="S52T0U900">v</span>*pi);  <span class="comment">% convert triangles to Hamming</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,236" id="srcline236">236</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,237" id="srcline237">237</a></span><span class="line"><span class="keyword">if</span> <span class="var type1" id="S14T2U906">sfact</span>==2  <span class="comment">% double all except the DC and Nyquist (if any) terms</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,238" id="srcline238">238</a></span><span class="line">    <span class="mxinfo" id="T40:U272"><span class="var type1" id="S57T40U910">msk</span>=<span class="mxinfo" id="T40:U274">(<span class="mxinfo" id="T40:U275"><span class="mxinfo" id="T41:U276"><span class="var type1" id="S51T41U915">c</span>+<span class="var type1" id="S4T2U916">mn</span></span>&gt;<span class="mxinfo" id="T2:U279">2</span></span>) &amp; (<span class="mxinfo" id="T40:U280"><span class="mxinfo" id="T41:U281"><span class="var type1" id="S51T41U921">c</span>+<span class="var type1" id="S4T2U922">mn</span></span>&lt;<span class="mxinfo" id="T2:U284"><span class="mxinfo" id="T2:U285"><span class="var type1" id="S7T2U925">n</span>-<span class="var type1" id="S26T2U926">fn2</span></span>+<span class="mxinfo" id="T2:U288">2</span></span></span>)</span></span>;  <span class="comment">% there is no Nyquist term if n is odd</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,239" id="srcline239">239</a></span><span class="line">    <span class="mxinfo" id="T41:U289"><span class="mxinfo" id="T41:U290"><span class="var type1" id="S52T41U931">v</span>(<span class="var type1" id="S57T40U932">msk</span>)</span>=<span class="mxinfo" id="T41:U293"><span class="mxinfo" id="T2:U294">2</span>*<span class="mxinfo" id="T41:U295"><span class="var type1" id="S52T41U936">v</span>(<span class="var type1" id="S57T40U937">msk</span>)</span></span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,240" id="srcline240">240</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,241" id="srcline241">241</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,242" id="srcline242">242</a></span><span class="line"><span class="comment">% sort out the output argument options</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,243" id="srcline243">243</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,244" id="srcline244">244</a></span><span class="line"><span class="keyword">if</span> nargout &gt; 2</span></span>
<span class="srcline"><span class="lineno"><a href="93,245" id="srcline245">245</a></span><span class="line">    <span class="comment">%r</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,246" id="srcline246">246</a></span><span class="line">    <span class="comment">%c</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,247" id="srcline247">247</a></span><span class="line">    <span class="comment">%v</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,248" id="srcline248">248</a></span><span class="line">    <span class="mxinfo" id="T18:U298"><span class="var type1" id="S2T18U946">x</span>=<span class="mxinfo" id="T18:U300"><span class="extrinsicFcn" id="F501N15:B948">sparse</span>(<span class="var type1" id="S48T41U949">r</span>,<span class="var type1" id="S51T41U950">c</span>,<span class="var type1" id="S52T41U951">v</span>)</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,249" id="srcline249">249</a></span><span class="line">    <span class="keyword">if</span> nargout == 3     <span class="comment">% if exactly three output arguments, then</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,250" id="srcline250">250</a></span><span class="line">        <span class="mxinfo" id="T41:U304"><span class="var type1" id="S3T41U960">mc</span>=<span class="var type1" id="S4T2U961">mn</span></span>;          <span class="comment">% delete mc output for legacy code compatibility</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,251" id="srcline251">251</a></span><span class="line">        <span class="mxinfo" id="T2:U307"><span class="var type1" id="S4T2U964">mn</span>=<span class="var type1" id="S5T2U965">mx</span></span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,252" id="srcline252">252</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,253" id="srcline253">253</a></span><span class="line"><span class="keyword">else</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,254" id="srcline254">254</a></span><span class="line">    <span class="var type0" id="S2T0U969">x</span>=sparse(<span class="var type0" id="S48T0U972">r</span>,<span class="var type0" id="S51T0U975">c</span>+<span class="var type0" id="S4T0U976">mn</span>-1,<span class="var type0" id="S52T0U978">v</span>,<span class="var type0" id="S6T0U979">p</span>,1+<span class="var type0" id="S26T0U982">fn2</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="93,255" id="srcline255">255</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,256" id="srcline256">256</a></span><span class="line"><span class="keyword">if</span> any(<span class="var type1" id="S11T10U988">w</span>==<span class="string">'u'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,257" id="srcline257">257</a></span><span class="line">    <span class="var type0" id="S60T0U992">sx</span>=sum(<span class="var type0" id="S2T0U995">x</span>,2);</span></span>
<span class="srcline"><span class="lineno"><a href="93,258" id="srcline258">258</a></span><span class="line">    <span class="var type0" id="S2T0U999">x</span>=<span class="var type0" id="S2T0U1001">x</span>./repmat(<span class="var type0" id="S60T0U1005">sx</span>+(<span class="var type0" id="S60T0U1008">sx</span>==0),1,size(<span class="var type0" id="S2T0U1013">x</span>,2));</span></span>
<span class="srcline"><span class="lineno"><a href="93,259" id="srcline259">259</a></span><span class="line"><span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,260" id="srcline260">260</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,261" id="srcline261">261</a></span><span class="line"><span class="comment">% plot results if no output arguments or g option given</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,262" id="srcline262">262</a></span><span class="line"><span class="comment">%</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,263" id="srcline263">263</a></span><span class="line"><span class="keyword">if</span> ~nargout || any(<span class="var type1" id="S11T10U1024">w</span>==<span class="string">'g'</span>) <span class="comment">% plot idealized filters</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,264" id="srcline264">264</a></span><span class="line">    <span class="var type0" id="S63T0U1028">ng</span>=201;     <span class="comment">% 201 points</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,265" id="srcline265">265</a></span><span class="line">    <span class="var type0" id="S64T0U1032">me</span>=<span class="var type0" id="S19T0U1035">mflh</span>(1)+(0:<span class="var type0" id="S6T0U1043">p</span>+1)'*<span class="var type0" id="S31T0U1045">melinc</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,266" id="srcline266">266</a></span><span class="line">    <span class="keyword">switch</span> <span class="var type0" id="S16T0U1047">wr</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,267" id="srcline267">267</a></span><span class="line">                <span class="keyword">case</span> <span class="string">'f'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,268" id="srcline268">268</a></span><span class="line">            <span class="var type0" id="S65T0U1052">fe</span>=<span class="var type0" id="S64T0U1053">me</span>; <span class="comment">% defining frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,269" id="srcline269">269</a></span><span class="line">            <span class="var type0" id="S66T0U1056">xg</span>=repmat(linspace(0,1,<span class="var type0" id="S63T0U1065">ng</span>),<span class="var type0" id="S6T0U1066">p</span>,1).*repmat(<span class="var type0" id="S64T0U1072">me</span>(3:end)-<span class="var type0" id="S64T0U1078">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1086">ng</span>)+repmat(<span class="var type0" id="S64T0U1090">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1098">ng</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="93,270" id="srcline270">270</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'l'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,271" id="srcline271">271</a></span><span class="line">            <span class="var type0" id="S65T0U1103">fe</span>=10.^<span class="var type0" id="S64T0U1106">me</span>; <span class="comment">% defining frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,272" id="srcline272">272</a></span><span class="line">            <span class="var type0" id="S66T0U1109">xg</span>=10.^(repmat(linspace(0,1,<span class="var type0" id="S63T0U1121">ng</span>),<span class="var type0" id="S6T0U1122">p</span>,1).*repmat(<span class="var type0" id="S64T0U1128">me</span>(3:end)-<span class="var type0" id="S64T0U1134">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1142">ng</span>)+repmat(<span class="var type0" id="S64T0U1146">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1154">ng</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="93,273" id="srcline273">273</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'e'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,274" id="srcline274">274</a></span><span class="line">            <span class="var type0" id="S65T0U1159">fe</span>=erb2frq(<span class="var type0" id="S64T0U1162">me</span>); <span class="comment">% defining frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,275" id="srcline275">275</a></span><span class="line">            <span class="var type0" id="S66T0U1165">xg</span>=erb2frq(repmat(linspace(0,1,<span class="var type0" id="S63T0U1176">ng</span>),<span class="var type0" id="S6T0U1177">p</span>,1).*repmat(<span class="var type0" id="S64T0U1183">me</span>(3:end)-<span class="var type0" id="S64T0U1189">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1197">ng</span>)+repmat(<span class="var type0" id="S64T0U1201">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1209">ng</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="93,276" id="srcline276">276</a></span><span class="line">        <span class="keyword">case</span> <span class="string">'b'</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,277" id="srcline277">277</a></span><span class="line">            <span class="var type0" id="S65T0U1214">fe</span>=bark2frq(<span class="var type0" id="S64T0U1217">me</span>); <span class="comment">% defining frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,278" id="srcline278">278</a></span><span class="line">            <span class="var type0" id="S66T0U1220">xg</span>=bark2frq(repmat(linspace(0,1,<span class="var type0" id="S63T0U1231">ng</span>),<span class="var type0" id="S6T0U1232">p</span>,1).*repmat(<span class="var type0" id="S64T0U1238">me</span>(3:end)-<span class="var type0" id="S64T0U1244">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1252">ng</span>)+repmat(<span class="var type0" id="S64T0U1256">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1264">ng</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="93,279" id="srcline279">279</a></span><span class="line">        <span class="keyword">otherwise</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,280" id="srcline280">280</a></span><span class="line">            <span class="var type0" id="S65T0U1268">fe</span>=mel2frq(<span class="var type0" id="S64T0U1271">me</span>); <span class="comment">% defining frequencies</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,281" id="srcline281">281</a></span><span class="line">            <span class="var type0" id="S66T0U1274">xg</span>=mel2frq(repmat(linspace(0,1,<span class="var type0" id="S63T0U1285">ng</span>),<span class="var type0" id="S6T0U1286">p</span>,1).*repmat(<span class="var type0" id="S64T0U1292">me</span>(3:end)-<span class="var type0" id="S64T0U1298">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1306">ng</span>)+repmat(<span class="var type0" id="S64T0U1310">me</span>(1:end-2),1,<span class="var type0" id="S63T0U1318">ng</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="93,282" id="srcline282">282</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,283" id="srcline283">283</a></span><span class="line"></span></span>
<span class="srcline"><span class="lineno"><a href="93,284" id="srcline284">284</a></span><span class="line">    <span class="var type0" id="S52T0U1321">v</span>=1-abs(linspace(-1,1,<span class="var type0" id="S63T0U1331">ng</span>));</span></span>
<span class="srcline"><span class="lineno"><a href="93,285" id="srcline285">285</a></span><span class="line">    <span class="keyword">if</span> any(<span class="var type0" id="S11T0U1337">w</span>==<span class="string">'n'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,286" id="srcline286">286</a></span><span class="line">        <span class="var type0" id="S52T0U1341">v</span>=0.5-0.5*cos(<span class="var type0" id="S52T0U1349">v</span>*pi);      <span class="comment">% convert triangles to Hanning</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,287" id="srcline287">287</a></span><span class="line">    <span class="keyword">elseif</span> any(<span class="var type0" id="S11T0U1356">w</span>==<span class="string">'m'</span>)</span></span>
<span class="srcline"><span class="lineno"><a href="93,288" id="srcline288">288</a></span><span class="line">        <span class="var type0" id="S52T0U1360">v</span>=0.5-0.46/1.08*cos(<span class="var type0" id="S52T0U1370">v</span>*pi);  <span class="comment">% convert triangles to Hamming</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,289" id="srcline289">289</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,290" id="srcline290">290</a></span><span class="line">    <span class="var type0" id="S52T0U1375">v</span>=<span class="var type0" id="S52T0U1377">v</span>*<span class="var type0" id="S14T0U1378">sfact</span>;  <span class="comment">% multiply by 2 if double sided</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,291" id="srcline291">291</a></span><span class="line">    <span class="var type0" id="S52T0U1381">v</span>=repmat(<span class="var type0" id="S52T0U1384">v</span>,<span class="var type0" id="S6T0U1385">p</span>,1);</span></span>
<span class="srcline"><span class="lineno"><a href="93,292" id="srcline292">292</a></span><span class="line">    <span class="keyword">if</span> any(<span class="var type0" id="S11T0U1392">w</span>==<span class="string">'y'</span>)  <span class="comment">% extend first and last filters</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,293" id="srcline293">293</a></span><span class="line">        <span class="var type0" id="S52T0U1397">v</span>(1,<span class="var type0" id="S66T0U1401">xg</span>(1,:)&lt;<span class="var type0" id="S65T0U1405">fe</span>(2))=<span class="var type0" id="S14T0U1407">sfact</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,294" id="srcline294">294</a></span><span class="line">        <span class="var type0" id="S52T0U1411">v</span>(end,<span class="var type0" id="S66T0U1416">xg</span>(end,:)&gt;<span class="var type0" id="S65T0U1421">fe</span>(<span class="var type0" id="S6T0U1423">p</span>+1))=<span class="var type0" id="S14T0U1425">sfact</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,295" id="srcline295">295</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,296" id="srcline296">296</a></span><span class="line">    <span class="keyword">if</span> any(<span class="var type0" id="S11T0U1431">w</span>==<span class="string">'u'</span>) <span class="comment">% scale to unity sum</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,297" id="srcline297">297</a></span><span class="line">        <span class="var type0" id="S68T0U1435">dx</span>=(<span class="var type0" id="S66T0U1440">xg</span>(:,3:end)-<span class="var type0" id="S66T0U1447">xg</span>(:,1:end-2))/2;</span></span>
<span class="srcline"><span class="lineno"><a href="93,298" id="srcline298">298</a></span><span class="line">        <span class="var type0" id="S68T0U1458">dx</span>=<span class="var type0" id="S68T0U1460">dx</span>(:,[1 1:<span class="var type0" id="S63T0U1468">ng</span>-2 <span class="var type0" id="S63T0U1471">ng</span>-2]);</span></span>
<span class="srcline"><span class="lineno"><a href="93,299" id="srcline299">299</a></span><span class="line">        <span class="var type0" id="S69T0U1475">vs</span>=sum(<span class="var type0" id="S52T0U1479">v</span>.*<span class="var type0" id="S68T0U1480">dx</span>,2);</span></span>
<span class="srcline"><span class="lineno"><a href="93,300" id="srcline300">300</a></span><span class="line">        <span class="var type0" id="S52T0U1484">v</span>=<span class="var type0" id="S52T0U1488">v</span>./repmat(<span class="var type0" id="S69T0U1492">vs</span>+(<span class="var type0" id="S69T0U1495">vs</span>==0),1,<span class="var type0" id="S63T0U1498">ng</span>)*<span class="var type0" id="S8T0U1499">fs</span>/<span class="var type0" id="S7T0U1500">n</span>;</span></span>
<span class="srcline"><span class="lineno"><a href="93,301" id="srcline301">301</a></span><span class="line">    <span class="keyword">end</span></span></span>
<span class="srcline"><span class="lineno"><a href="93,302" id="srcline302">302</a></span><span class="line">    plot(<span class="var type0" id="S66T0U1505">xg</span>',<span class="var type0" id="S52T0U1507">v</span>',<span class="string">'b'</span>);</span></span>
<span class="srcline"><span class="lineno"><a href="93,303" id="srcline303">303</a></span><span class="line">    set(gca,<span class="string">'xlim'</span>,[<span class="var type0" id="S65T0U1518">fe</span>(1) <span class="var type0" id="S65T0U1521">fe</span>(end)]);</span></span>
<span class="srcline"><span class="lineno"><a href="93,304" id="srcline304">304</a></span><span class="line">    xlabel([<span class="string">'Frequency ('</span> xticksi <span class="string">'Hz)'</span>]);</span></span>
<span class="srcline"><span class="lineno"><a href="93,305" id="srcline305">305</a></span><span class="line"><span class="keyword"><span class="keyword">end</span></span></span></span>
</pre>
